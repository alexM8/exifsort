ExifSort
==============

## Как работает:
- Если найден файл JPG, для него считывается exif-данные и создается папка в originals, имя которой соответствует времени чч-мм-сс фотографии. Также, этот файл копируется в previews.
- Если следующий файл тоже JPG, он перемещается в папку, созданную в предыдущем шаге
- Если найден файл NEF, скрипт перемещает его в nefs.
- Для следующего считаного JPG считываются exif-данные и создается папка в originals, имя которой соответствует времени чч-мм-сс фотографии. Также, этот файл копируется в previews.
- Если следующий файл тоже JPG, он перемещается в папку, созданную в предыдущем шаге.
- И так далее, пока не закончатся файлы в tmp
- Удаляются все жесткие ссылки на фото в папке slides, созданные при предыдущем запуске этого скрипта.
- Создаются новые жесткие ссылки на фотки из последних 10 папок в originals

## Структура папок:
- tmp/           временная папка, откуда поступают фотографии
- originals/     сюда перемещаются фотографии после обработки их exif-данных
- nefs/          сюда перемещаются nef-файлы, которые являются основой для сортировки
- previews/      сода помещаются по одной фотографии с каждого раздела
- resizes/       здесь хранятся фотографии с меньшим размером, чем оригиналы. Структура папок та же, что и в оригинальных. Небоходимо для галереи piwigo
- slides/        папка, в которой создаются жесткие ссылки на фото из последних 10 папок в originals. Отсюдова будут братся фотки для слайдшоу
- .sorted        файл, в котором записуются результаты копирования при одной отработке скрипта, Нужно для того, чтобы потом конвертер знал, какие фотки ему нужно конвертировать
- .fail          файл, который создается, если exif не смог достать из фотки exif-данные. В таком случае, работа скрипта прекращается

## Необходимо:
- uuidgen утилита, которая может создать рандомные данные в формате uuid
- exif утилита, которая может извлечь данные из JPG/NEF файла
- Mac OS. Совместимость с остальными UNIX подобными системами не проверялась

## Как пользоватся:
- фотографии создаются пачками JPGов
- пачки разделяются через создание фотографии в несжатом формате NEF
- скриптом bootstrap.sh флешка метится созданием скрытого файла с нагенерированым uuid
- этот же uuid записывается в файл .flashdrives c именем флешки
- checkdaemon.sh работает в режиме демона. Он постоянно сканирует новоподключенные флешки и если находит метку, начинает сливать с нее фотки
- после того, как фотки были скопированы, авотматически запускается sortphoto.sh, который их сортирует, ресайзит, линкует и тп.

## Дополнительная информация:
- фотки с флешки удаляются после подтверждения
- для слайдшоу используются жесткие ссилки ибо с симвользными слайдшоу на Mac OS не запускалось
- обо всех действиях скрипт информирует пользователя через систему уведомлений Mac Os (osascript)
- баги могут возникнуть на этапе включения новых флешек (кривая проверка через df)
- порядок сканирования фотографий практически ничем не регулируется (ls по дефолту сортирует по имени)
- есть баг когда создано более 1000 фотографий - счетчик обнуляется и кривой порядок сканирования дает о себе знать (IMG_9999.jpg -> IMG_0000.jpg)
- для извлечения флешки используется diskutil (нативная утилита Mac Os)
- все необходимые папки создаются на этапе sortphoto.sh
- код кривой, но сильно закомментирован. был молод.
- если вы мой потенциальный работодатель, и видите этот код, знайте что я разбираюсь в баше. в такой манере я больше не пишу
